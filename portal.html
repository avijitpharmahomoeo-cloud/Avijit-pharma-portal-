<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medicine Inventory Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .form-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }
        /* Custom Loading Spinner */
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid #fff;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen pb-12">

    <!-- Header Navigation -->
    <header class="glass-effect sticky top-0 z-50 border-b border-slate-200">
        <div class="max-w-4xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <div class="bg-blue-600 p-2 rounded-lg">
                    <i data-lucide="pill" class="text-white w-5 h-5"></i>
                </div>
                <h1 class="text-lg font-bold text-slate-800 hidden sm:block">MedInventory</h1>
            </div>
            
            <a href="https://docs.google.com/spreadsheets/d/1atvxvuFJAcDiF_6kXx1kfX2fSfd4o68sMruit_DQbJY/edit?usp=sharing" 
               target="_blank" 
               class="flex items-center gap-2 bg-slate-800 hover:bg-slate-900 text-white px-4 py-2 rounded-full text-sm font-medium transition-all shadow-md hover:shadow-lg">
                <i data-lucide="external-link" class="w-4 h-4"></i>
                Edit Medicine
            </a>
        </div>
    </header>

    <main class="max-w-2xl mx-auto px-4 pt-8">
        <!-- Form Container -->
        <div class="bg-white rounded-3xl shadow-xl shadow-slate-200/50 border border-slate-100 overflow-hidden">
            <div class="p-6 sm:p-8 bg-gradient-to-br from-blue-50 to-white border-b border-slate-100">
                <h2 class="text-2xl font-bold text-slate-800">Add New Entry</h2>
                <p class="text-slate-500 mt-1">Fill in the details to update your Google Sheet.</p>
            </div>

            <!-- Hidden Iframe for Silent Submission -->
            <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"></iframe>

            <!-- Form -->
            <form 
                action="https://docs.google.com/forms/d/e/1FAIpQLSep1aMTQNJtdweO6OU7Z8sLvh3nM-Adi7pto2Gq3PCei99uFg/formResponse" 
                method="POST" 
                target="hidden_iframe" 
                id="medicineForm"
                class="p-6 sm:p-8 space-y-6"
                onsubmit="return handleSubmit()"
            >
                
                <!-- Image Section -->
                <div class="space-y-2">
                    <label class="block text-sm font-semibold text-slate-700">Medicine Image URL</label>
                    <div class="flex flex-col sm:flex-row gap-4">
                        <div class="relative flex-grow">
                            <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-slate-400">
                                <i data-lucide="image" class="w-4 h-4"></i>
                            </span>
                            <input 
                                type="url" 
                                name="entry.581049428" 
                                id="imageUrlInput"
                                placeholder="https://example.com/image.jpg"
                                class="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all text-slate-800"
                                required
                            >
                        </div>
                        <div id="imagePreview" class="w-full sm:w-20 h-20 bg-slate-100 rounded-xl flex items-center justify-center overflow-hidden border border-slate-200">
                            <i data-lucide="camera" class="text-slate-300 w-6 h-6"></i>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                    <!-- Name -->
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-slate-700">Medicine Name</label>
                        <input 
                            type="text" 
                            name="entry.898797728" 
                            placeholder="e.g. Paracetamol"
                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all"
                            required
                        >
                    </div>

                    <!-- Type -->
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-slate-700">Type</label>
                        <input 
                            type="text" 
                            name="entry.435498266" 
                            placeholder="e.g. Pain Reliever"
                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all"
                            required
                        >
                    </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                    <!-- Category Dropdown -->
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-slate-700">Category</label>
                        <select 
                            name="entry.1729096755" 
                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all appearance-none cursor-pointer"
                            required
                        >
                            <option value="" disabled selected>Select Category</option>
                            <option value="Dilution">Dilution</option>
                            <option value="Globules (Pills)">Globules (Pills)</option>
                            <option value="Tablets">Tablets</option>
                            <option value="Mother Tincture">Mother Tincture</option>
                            <option value="Ointment / Cream">Ointment / Cream</option>
                            <option value="Powder">Powder</option>
                            <option value="Biochemic (Tissue) Salts">Biochemic (Tissue) Salts</option>
                            <option value="cosmetic">Cosmetic</option>
                        </select>
                    </div>

                    <!-- Price -->
                    <div class="space-y-2">
                        <label class="block text-sm font-semibold text-slate-700">Price (INR)</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 pl-4 flex items-center text-slate-500 font-medium">â‚¹</span>
                            <input 
                                type="number" 
                                name="entry.673671764" 
                                placeholder="0.00"
                                class="w-full pl-8 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all"
                                required
                            >
                        </div>
                    </div>
                </div>

                <!-- Stock Dropdown (Updated with single numeric option '1') -->
                <div class="space-y-2">
                    <label class="block text-sm font-semibold text-slate-700">Stock Availability</label>
                    <select 
                        name="entry.1606692666" 
                        class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all cursor-pointer"
                        required
                    >
                        <option value="1">1</option>
                    </select>
                </div>

                <!-- Description -->
                <div class="space-y-2">
                    <label class="block text-sm font-semibold text-slate-700">Description</label>
                    <textarea 
                        name="entry.230614477" 
                        rows="3"
                        placeholder="Additional details about the medicine..."
                        class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all"
                    ></textarea>
                </div>

                <!-- Submit Button -->
                <button 
                    type="submit" 
                    id="submitBtn"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-2xl transition-all shadow-lg shadow-blue-200 flex items-center justify-center gap-2 group"
                >
                    <span id="btnText">Submit Entry</span>
                    <div id="btnLoader" class="spinner hidden"></div>
                    <i data-lucide="chevron-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
                </button>
            </form>
        </div>

        <!-- Success Message Toast (Hidden by default) -->
        <div id="successToast" class="fixed bottom-8 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-6 py-4 rounded-2xl shadow-2xl flex items-center gap-3 transition-all duration-500 opacity-0 translate-y-10 pointer-events-none z-[60]">
            <div class="bg-green-500 p-1 rounded-full">
                <i data-lucide="check" class="w-4 h-4 text-white"></i>
            </div>
            <p class="font-medium">Form submitted successfully!</p>
        </div>
    </main>

    <script>
        // Initialize Lucide Icons
        lucide.createIcons();

        const form = document.getElementById('medicineForm');
        const submitBtn = document.getElementById('submitBtn');
        const btnText = document.getElementById('btnText');
        const btnLoader = document.getElementById('btnLoader');
        const successToast = document.getElementById('successToast');
        const imageUrlInput = document.getElementById('imageUrlInput');
        const imagePreview = document.getElementById('imagePreview');

        // Handle Image Preview
        imageUrlInput.addEventListener('input', (e) => {
            const url = e.target.value;
            if (url && (url.match(/\.(jpeg|jpg|gif|png)$/) != null || url.includes('unsplash.com'))) {
                imagePreview.innerHTML = `<img src="${url}" class="w-full h-full object-cover" onerror="handleImageError()">`;
            } else {
                imagePreview.innerHTML = `<i data-lucide="camera" class="text-slate-300 w-6 h-6"></i>`;
                lucide.createIcons();
            }
        });

        function handleImageError() {
            imagePreview.innerHTML = `<i data-lucide="alert-circle" class="text-red-300 w-6 h-6"></i>`;
            lucide.createIcons();
        }

        // Silent Submission Logic
        let isSubmitting = false;

        function handleSubmit() {
            if (isSubmitting) return false;
            
            isSubmitting = true;
            submitBtn.disabled = true;
            btnText.textContent = 'Submitting...';
            btnLoader.classList.remove('hidden');

            // The form will now submit to the hidden iframe
            const iframe = document.getElementById('hidden_iframe');
            
            iframe.onload = function() {
                if (isSubmitting) {
                    showSuccess();
                }
            };

            return true;
        }

        function showSuccess() {
            isSubmitting = false;
            submitBtn.disabled = false;
            btnText.textContent = 'Submit Entry';
            btnLoader.classList.add('hidden');
            
            // Show Toast
            successToast.classList.remove('opacity-0', 'translate-y-10', 'pointer-events-none');
            
            // Clear Form
            form.reset();
            imagePreview.innerHTML = `<i data-lucide="camera" class="text-slate-300 w-6 h-6"></i>`;
            lucide.createIcons();

            // Hide Toast after 4 seconds
            setTimeout(() => {
                successToast.classList.add('opacity-0', 'translate-y-10', 'pointer-events-none');
            }, 4000);
        }
    </script>
</body>
</html>